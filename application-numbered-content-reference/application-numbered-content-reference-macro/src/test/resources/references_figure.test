.runTransformations:macro
.#-----------------------------------------------------
.input|xwiki/2.1
.# Test the macro on a simple case with the default parameters.
.#-----------------------------------------------------
See figure {{reference figure="f1"/}}.

{{figure}}
[[image:http://www.clker.com/cliparts/3/m/v/Y/E/V/small-red-apple-md.png||width="100"]]

{{figureCaption}}
{{id name="f1"/}}An image
{{/figureCaption}}
{{/figure}}

See table {{reference figure="t1"/}}.

{{figure}}
|a|b
|c|d

{{figureCaption}}
{{id name="t1"/}}A table
{{/figureCaption}}
{{/figure}}
.#-----------------------------------------------------
.expect|xhtml/1.0
.#-----------------------------------------------------
<p>See figure <span class="wikilink"><a href="#f1">1</a></span>.</p><p><img src="http://www.clker.com/cliparts/3/m/v/Y/E/V/small-red-apple-md.png" width="100" id="Ihttp:2F2Fwww.clker.com2Fcliparts2F32Fm2Fv2FY2FE2FV2Fsmall-red-apple-md.png" class="wikigeneratedid" alt="http://www.clker.com/cliparts/3/m/v/Y/E/V/small-red-apple-md.png"/></p><div class="figcaption"><p><span id="f1"></span>An image</p></div><p>See table <span class="wikilink"><a href="#t1">2</a></span>.</p><table><tr><td>a</td><td>b</td></tr><tr><td>c</td><td>d</td></tr></table><div class="figcaption"><p><span id="t1"></span>A table</p></div>
.#-----------------------------------------------------
.expect|event/1.0
.#-----------------------------------------------------
beginDocument
beginParagraph
onWord [See]
onSpace
onWord [figure]
onSpace
beginMacroMarkerInline [reference] [figure=f1]
beginLink [Typed = [true] Type = [doc] Reference = [] Parameters = [[anchor] = [f1]]] [false]
onWord [1]
endLink [Typed = [true] Type = [doc] Reference = [] Parameters = [[anchor] = [f1]]] [false]
endMacroMarkerInline [reference] [figure=f1]
onSpecialSymbol [.]
endParagraph
beginMacroMarkerStandalone [figure] [] [[[image:http://www.clker.com/cliparts/3/m/v/Y/E/V/small-red-apple-md.png||width="100"]]

{{figureCaption}}
{{id name="f1"/}}An image
{{/figureCaption}}]
beginFigure
beginMetaData [[non-generated-content]=[java.util.List<org.xwiki.rendering.block.Block>]]
beginParagraph
onImage [Typed = [false] Type = [url] Reference = [http://www.clker.com/cliparts/3/m/v/Y/E/V/small-red-apple-md.png]] [false] [Ihttp:2F2Fwww.clker.com2Fcliparts2F32Fm2Fv2FY2FE2FV2Fsmall-red-apple-md.png] [[width]=[100]]
endParagraph
beginMacroMarkerStandalone [figureCaption] [] [{{id name="f1"/}}An image]
beginFigureCaption
beginMetaData [[non-generated-content]=[java.util.List<org.xwiki.rendering.block.Block>]]
beginParagraph
beginMacroMarkerInline [id] [name=f1]
onId [f1]
endMacroMarkerInline [id] [name=f1]
onWord [An]
onSpace
onWord [image]
endParagraph
endMetaData [[non-generated-content]=[java.util.List<org.xwiki.rendering.block.Block>]]
endFigureCaption
endMacroMarkerStandalone [figureCaption] [] [{{id name="f1"/}}An image]
endMetaData [[non-generated-content]=[java.util.List<org.xwiki.rendering.block.Block>]]
endFigure
endMacroMarkerStandalone [figure] [] [[[image:http://www.clker.com/cliparts/3/m/v/Y/E/V/small-red-apple-md.png||width="100"]]

{{figureCaption}}
{{id name="f1"/}}An image
{{/figureCaption}}]
beginParagraph
onWord [See]
onSpace
onWord [table]
onSpace
beginMacroMarkerInline [reference] [figure=t1]
beginLink [Typed = [true] Type = [doc] Reference = [] Parameters = [[anchor] = [t1]]] [false]
onWord [2]
endLink [Typed = [true] Type = [doc] Reference = [] Parameters = [[anchor] = [t1]]] [false]
endMacroMarkerInline [reference] [figure=t1]
onSpecialSymbol [.]
endParagraph
beginMacroMarkerStandalone [figure] [] [|a|b
|c|d

{{figureCaption}}
{{id name="t1"/}}A table
{{/figureCaption}}]
beginFigure
beginMetaData [[non-generated-content]=[java.util.List<org.xwiki.rendering.block.Block>]]
beginTable
beginTableRow
beginTableCell
onWord [a]
endTableCell
beginTableCell
onWord [b]
endTableCell
endTableRow
beginTableRow
beginTableCell
onWord [c]
endTableCell
beginTableCell
onWord [d]
endTableCell
endTableRow
endTable
beginMacroMarkerStandalone [figureCaption] [] [{{id name="t1"/}}A table]
beginFigureCaption
beginMetaData [[non-generated-content]=[java.util.List<org.xwiki.rendering.block.Block>]]
beginParagraph
beginMacroMarkerInline [id] [name=t1]
onId [t1]
endMacroMarkerInline [id] [name=t1]
onWord [A]
onSpace
onWord [table]
endParagraph
endMetaData [[non-generated-content]=[java.util.List<org.xwiki.rendering.block.Block>]]
endFigureCaption
endMacroMarkerStandalone [figureCaption] [] [{{id name="t1"/}}A table]
endMetaData [[non-generated-content]=[java.util.List<org.xwiki.rendering.block.Block>]]
endFigure
endMacroMarkerStandalone [figure] [] [|a|b
|c|d

{{figureCaption}}
{{id name="t1"/}}A table
{{/figureCaption}}]
endDocument